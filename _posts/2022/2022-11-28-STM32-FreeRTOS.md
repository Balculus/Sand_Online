---
layout: post
title: STM32 FreeRTOS 相关
date: 2022-11-28
author: 来自第一世界
tags: [STM32]
comments: false
---
总结一下 STM32 FreeRTOS 系统的一些知识。

# FreeRTOS

111

## 任务

### 任务状态

FreeRTOS 中的任务永远处于下面几个状态中的某一个:

* 运行态：当一个任务正在运行时，那么就说这个任务处于运行态，处于运行态的任务就是当前正在使用处理器的任务。如果使用的是单核处理器的话那么不管在任何时刻永远都只有一个任务处于运行态；
* 就绪态：处于就绪态的任务是那些已经准备就绪（这些任务没有被阻寒或者挂起），可以运行的任务，但是处于就绪态的任务还没有运行，因为有一个同优先级或者更高优先级的任务正在运行；
* 阻塞态：如果一个任务当前正在等待某个外部事件的话就说它处于阻塞态，比如说如果某个任务调用了函数 `vTaskDelay()` 的话就会进入阻塞态，直到延时周期完成。任务在等待队列、信号量、事件组、通知或互斥信号量的时候也会进入阻塞态。任务进入阻塞态会有一个超时时间，当超过这个超时时间任务就会退出阻塞态，即使所等待的事件还没有来临；
* 挂起态：像阻塞态一样，任务进入挂起态以后也不能被调度器调用进入运行态，但是进入挂起态的任务没有超时时间。任务进入和退出挂起态通过调用函数 `vIaskSuspend()` 和 `xTaskResume()`。

### 任务优先级

每个任务都可以分配一个从 0~(configMAX_PRIORITIES-1) 的优先级，这个参数在文件 FreeRTOSConfig.h 中有定义。

优先级数字越低表示任务的优先级越低，0 的优先级最低，空闲任务的优先级最低，为 0。FreeRTOS 调度器确保处于就绪态或运行态的高优先级的任务获取处理器使用权，换句话说就是处于就绪态的最高优先级的任务才会运行。

### 任务实现

函数 `xTaskCreate()` 或者 `xTaskCreateStatic() `用于创建任务。函数的第一个参数为 `pxTaskCode`，为此任务的任务函数，即想要实现的功能。

任务函数的模板为：

```c
void vATaskFunction(void *pvParameters)
{
	for(;;)
	{
		# code
		vTaskDelay();
	}
	vTaskDelete(NULL); # 中途退出
}
```





11
