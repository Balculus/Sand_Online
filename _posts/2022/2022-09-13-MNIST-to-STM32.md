---
layout: post
title: 将手写数字识别部署在STM32
date: 2022-09-13
author: 来自第一世界
tags: [STM32, AI]
comments: false
---
为了做一点技术储备，因此考虑实现一个手写数字识别在STM32部署的项目。

整个项目的思路很简单，将深度学习中的入门项目，MNIST手写数字识别部署在STM32板子上，因为手里也没有其他的板子，就只能拿正点原子那块板来练手，正好上面是有LCD能够提供显示和触屏功能。

可以预估的一些困难：

* 首先能够想到是数据集和实际用起来不一致的问题：数据集的像素和STM32采集到的数据必定会有差距，因此如何调整将会是一个困难的点；
* 其次是模型大小的问题：这个要实际操作看一下，模型不能够太大超过芯片的容纳范围；
* 一些编程上的问题，这就不说了。

初步预想采用keras+X-CUBE-AI的方式实现，这一步骤应该问题不大。

需要加点模数转换和通信的东西，多熟悉一下。

可以实现两种更新方式，通过X-CUBE-AI或者直接保留矩阵的权重，直接计算。

第二种思路可以参考这篇文章https://shequ.stmicroelectronics.cn/forum.php?mod=viewthread&tid=631175

这篇博客主要是记录一些想法、思路和困难，并没有细致整理，这一部分工作应该会留在整个项目完成后实现，如果能够顺利实现的话。

关于降低图像分辨率的方法，目前调研的可以将原本图像分为若干份，然后去第一个方块的颜色作为整体的方块颜色

同样一篇值得参考的博客 https://blog.csdn.net/yy1165634662/article/details/113588997

目前遇到的问题与解决方案：

1 首先就是环境设置的问题，在安装好kears和tf以后，程序也跑通了，然后模型也训练出来了，在载入X-CUBE-AI中才发现，安装的版本过高，因此无法进行下一步处理

解决方案：重新安装，在kears安装中，提示tf版本也不太匹配，但程序还是能够直接运行，因此就暂时搁置不管，注意X-CUBE-AI仅支持keras==2.9.0及以下的版本

2 模型过大的问题，这个问题其实是可以预见到的，目前这个模型需要存储1.42MB，但是芯片只能够存储1MB的数据，因此无法直接载入。

解决方案：这里有两个预估可行的方案，分别尝试。第一个是缩小模型大小，降低层数，这可能会牺牲一部分精度；第二个方法是在STM32设计中把存储加入进来，这会增加程序的复杂程度。
