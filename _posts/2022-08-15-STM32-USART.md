---
layout: post
title: STM32 串口通信
date: 2022-08-15
Author: 来自第一世界
tags: [STM32]
comments: false
---
本篇主要记录STM32串口学习记录。

```
USART_InitStructure.USART_BaudRate = bound;//一般设置为9600;
USART_InitStructure.USART_WordLength = USART_WordLength_8b;//字长为8 位数据格式
USART_InitStructure.USART_StopBits = USART_StopBits_1;//一个停止位
USART_InitStructure.USART_Parity = USART_Parity_No;//无奇偶校验位
USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;//收发模式
USART_Init(USART1, &USART_InitStructure); //初始化串口
```

通用同步异步收发器（Universal Synchronous/Asynchronous Receiver/Transmitter, USART）

# 串口通信

来源于百度百科的串口定义：

> 串行接口是一种可以将接收来自CPU的并行数据字符转换为连续的串行数据流发送出去，同时可将接收的串行数据流转换为并行的数据字符供给CPU的器件。
>
> 串口通信（Serial Communications）的概念非常简单，串口按位（bit）发送和接收字节的通信方式。

## 关键参数

* 波特率

波特率是衡量符号传输速率的参数，表示单位时间内载波参数变化的次数。如每秒钟传送240个字符，而每个字符格式包含10位（1个起始位，1个停止位，8个数据位），这时的波特率为240Bd，比特率为10位*240个/秒=2400bps。波特率和距离成反比，高波特率常常用于放置的很近的仪器间的通信。

* 数据位

数据位是衡量实际数据位的参数。一个例子，如果数据使用简单的文本（标准 ASCII码），那么每个数据包使用7位数据。每个包是指一个字节，包括开始/停止位，数据位和奇偶校验位。由于实际数据位取决于通信协议的选取，术语“包”指任何通信的情况。

* 停止位

包最后一位，表示数据的终结，典型值为1，1.5和2位。由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。

* 奇偶校验位

串口通信中有4种校验方式：偶、奇、高和低。对于偶和奇校验的情况，串口会设置校验位（数据位后面的一位），用一个值确保传输的数据有偶个或者奇个逻辑高位。当然没有校验位也是可以的。

# USART

STM32中

# 串口设置步骤

1) 串口时钟使能，GPIO 时钟使能。
2) 设置引脚复用器映射：调用GPIO_PinAFConfig 函数。
3) GPIO 初始化设置：要设置模式为复用功能。
4) 串口参数初始化：设置波特率，字长，奇偶校验等参数。
5) 开启中断并且初始化NVIC，使能中断（如果需要开启中断才需要这个步骤）。
6) 使能串口。
7) 编写中断处理函数：函数名格式为USARTxIRQHandler(x 对应串口号)。
