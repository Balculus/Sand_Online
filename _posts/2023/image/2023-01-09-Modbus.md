---
layout: post
title: Modbus 协议总结
date: 2022-08-15
author: 来自第一世界
tags: [STM32]
comments: false
---
Modbus 是一种串行通信协议，在工业界比较普遍，本篇主要总结一下数据帧的格式和使用的一些规范。




### **1、读可读写数字量寄存器（线圈状态）：**

计算机发送命令：

[设备地址] [命令号01] [起始寄存器地址高8位] [低8位] [读取的寄存器数高8位] [低8位] [CRC校验的低8位] [CRC校验的高8位]

例：[11][01][00][13][00][25][CRC低][CRC高]

意义如下：

（1）设备地址：在一个485总线上可以挂接多个设备，此处的设备地址表示想和哪一个设备通讯。例子中为想和17号(十进制的17是十六进制的11)通讯。

（2）命令号01：读取数字量的命令号固定为01。

（3）起始地址高8位、低8位：表示想读取的开关量的起始地址(起始地址为0)。比如例子中的起始地址为19。

（4）寄存器数高8位、低8位：表示从起始地址开始读多少个开关量。例子中为37个开关量。

（5）CRC校验：是从开头一直校验到此之前。在此协议的最后再作介绍。此处需要注意，CRC校验在命令中的高低字节的顺序和其他的相反。

**设备响应：[设备地址] [命令号01] [返回的字节个数][数据1][数据2]...[数据n][CRC校验的低8位] [CRC校验的高8位]**

例：[11][01][05][CD][6B][B2][0E][1B][CRC低][CRC高]

意义如下：

（1）设备地址和命令号和上面的相同。

（2）返回的字节个数：表示数据的字节个数，也就是数据1，2...n中的n的值。

（3）数据1...n：由于每一个数据是一个8位的数，所以每一个数据表示8个开关量的值，每一位为0表示对应的开关断开，为1表示闭合。比如例子中，表示20号(索引号为19)开关闭合，21号断开，22闭合，23闭合，24断开，25断开，26闭合，27闭合...如果询问的开关量不是8的整倍数，那么最后一个字节的高位部分无意义，置为0。

（4）CRC校验同上。

**2、读只可读数字量寄存器(输入状态)：**

和读取线圈状态类似，只是第二个字节的命令号不再是1而是2。

**3、写数字量(线圈状态)：**

计算机发送命令：**[设备地址] [命令号05] [需下置的寄存器地址高8位] [低8位] [下置的数据高8位] [低8位] [CRC校验的低8位] [CRC校验的高8位]**

例：[11][05][00][AC][FF][00][CRC低][CRC高]

意义如下：

（1）设备地址和上面的相同。

（2）命令号:写数字量的命令号固定为05。

（3）需下置的寄存器地址高8位，低8位：表明了需要下置的开关的地址。

（4）下置的数据高8位，低8位：表明需要下置的开关量的状态。例子中为把该开关闭合。注意，此处只可以是[FF][00]表示闭合[00][00]表示断开，其他数值非法。

（5）注意此命令一条只能下置一个开关量的状态。

设备响应：**如果成功把计算机发送的命令原样返回，否则不响应。**

**4、读可读写模拟量寄存器(保持寄存器)：**

计算机发送命令：**[设备地址] [命令号03] [起始寄存器地址高8位] [低8位] [读取的寄存器数高8位] [低8位] [CRC校验的低8位] [CRC校验的高8位]**

例：[11][03][00][6B][00][03][CRC低][CRC高]

意义如下：

（1）设备地址和上面的相同。

（2）命令号:读模拟量的命令号固定为03。

（3）起始地址高8位、低8位：表示想读取的模拟量的起始地址(起始地址为0)。比如例子中的起始地址为107。

（4）寄存器数高8位、低8位：表示从起始地址开始读多少个模拟量。例子中为3个模拟量。注意，在返回的信息中一个模拟量需要返回两个字节。

**设备响应：[设备地址] [命令号03] [返回的字节个数][数据1][数据2]...[数据n][CRC校验的低8位] [CRC校验的高8位]**

例：[11][03][06][02][2B][00][00][00][64][CRC低][CRC高]

**意义如下：**

（1）设备地址和命令号和上面的相同。

（2）返回的字节个数：表示数据的字节个数，也就是数据1，2...n中的n的值。例子中返回了3个模拟量的数据，因为一个模拟量需要2个字节所以共6个字节。

（3）数据1...n：其中[数据1][数据2]分别是第1个模拟量的高8位和低8位，[数据3][数据4]是第2个模拟量的高8位和低8位，以此类推。例子中返回的值分别是555，0，100。

（4）CRC校验同上。

**5、读只可读模拟量寄存器(输入寄存器)：**

和读取保存寄存器类似，只是第二个字节的命令号不再是2而是4。

**6、写单个模拟量寄存器(保持寄存器)：**

计算机发送命令：**[设备地址] [命令号06] [需下置的寄存器地址高8位] [低8位] [下置的数据高8位] [低8位] [CRC校验的低8位] [CRC校验的高8位]**

例：[11][06][00][01][00][03][CRC低][CRC高]

意义如下：

（1）设备地址和上面的相同。

（2）命令号:写模拟量的命令号固定为06。

（3）需下置的寄存器地址高8位，低8位：表明了需要下置的模拟量寄存器的地址。

（4）下置的数据高8位，低8位：表明需要下置的模拟量数据。比如例子中就把1号寄存器的值设为3。

（5）注意此命令一条只能下置一个模拟量的状态。

设备响应：**如果成功把计算机发送的命令原样返回，否则不响应。 **

19人点赞

[工控通信篇](/nb/34981520)

作者：漠漠彡
链接：https://www.jianshu.com/p/f7fd49a51f23
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
